{% extends "shop/base.html" %}
{% load humanize %}

{% block title %}Manajemen Pesanan | AF Promotion{% endblock %}

{% block content %}

<style>
  * {
    font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, sans-serif !important;
  }

  body {
    background: #f7f4f2;
  }

  .m-orders-page {
    max-width: 1100px;
    margin: 2.6rem auto 4rem;
    padding: 0 clamp(1rem, 4vw, 1.5rem) 2rem;
    color: #2C2524;
  }

  .m-page-title {
    font-size: clamp(1.5rem, 2vw + 1rem, 1.9rem);
    font-weight: 700;
    color: #7A0E1A;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 0.4rem;
  }

  .m-page-sub {
    font-size: 0.9rem;
    color: #8A7F7C;
    margin-bottom: 1.8rem;
  }

  /* FILTER BAR */
  .m-filter-bar {
    display: flex;
    align-items: center;
    gap: .75rem;
    margin-bottom: 1.4rem;
    padding: 0.9rem 1.1rem;
    border-radius: 999px;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 10px 24px rgba(0,0,0,0.04);
    border: 1px solid rgba(230, 220, 215, .9);
  }

  .m-filter-label {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: .16em;
    color: #8A7F7C;
  }

  .m-filter-select {
    border-radius: 999px;
    padding: 0.4rem 0.9rem;
    border: 1px solid rgba(210, 198, 193, 0.8);
    font-size: 0.85rem;
    background: #fdfaf8;
    outline: none;
  }

  .m-filter-select:focus {
    border-color: #7A0E1A;
  }

  @media (max-width: 640px) {
    .m-filter-bar {
      padding-inline: 0.9rem;
    }
  }

  /* WRAPPER TABEL */
  .m-table-wrap {
    border-radius: 18px;
    background: #ffffff;
    box-shadow:
      0 12px 30px rgba(0,0,0,0.06),
      inset 0 0 0 1px rgba(255,255,255,0.9);
    padding: 1.3rem 1.3rem 1.5rem;
    overflow-x: auto;               /* penting buat mobile */
    -webkit-overflow-scrolling: touch;
  }

  .m-table {
    width: 100%;
    min-width: 820px;               /* biar kolom nggak kepres di HP */
    border-collapse: collapse;
    font-size: 0.88rem;
  }

  .m-table thead th {
    text-align: left;
    padding-bottom: 0.45rem;
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: #8A7F7C;
    border-bottom: 1px solid rgba(219, 208, 203, 0.95);
    white-space: nowrap;
  }

  .m-table tbody td {
    padding: 0.6rem 0;
    border-bottom: 1px solid rgba(238, 229, 225, 0.9);
    vertical-align: middle;
  }

  .m-table tbody tr:last-child td {
    border-bottom: none;
  }

  /* STATUS BADGE (opsional kalau mau dipakai lagi) */
  .m-status-badge {
    display: inline-block;
    padding: 0.18rem 0.6rem;
    border-radius: 999px;
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }
  .badge-PENDING { background: rgba(244, 158, 38, 0.16); color: #B45309; }
  .badge-PAID { background: rgba(16, 185, 129, 0.18); color: #047857; }
  .badge-PROCESSING { background: rgba(59, 130, 246, 0.16); color: #1D4ED8; }
  .badge-SHIPPED { background: rgba(14, 165, 233, 0.16); color: #0369A1; }
  .badge-COMPLETED { background: rgba(34, 197, 94, 0.16); color: #15803D; }
  .badge-CANCELLED { background: rgba(239, 68, 68, 0.16); color: #B91C1C; }

  /* FORM UPDATE (INLINE) */
  .m-update-form {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    font-size: 0.78rem;
  }

  .m-update-select,
  .m-update-input {
    border-radius: 999px;
    padding: 0.28rem 0.7rem;
    border: 1px solid rgba(214, 202, 197, 0.9);
    font-size: 0.78rem;
    background: #FDF9F7;
    outline: none;
    width: 100%;
  }

  .m-update-select:focus,
  .m-update-input:focus {
    border-color: #7A0E1A;
  }

  .m-update-btn {
    align-self: flex-start;
    padding: 0.32rem 1rem;
    border-radius: 999px;
    border: none;
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    background: #7A0E1A;
    color: #fff;
    cursor: pointer;
    transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    box-shadow: 0 8px 18px rgba(122, 14, 26, 0.35);
    margin-top: 0.1rem;
    white-space: nowrap;
  }

  .m-update-btn:hover {
    background: #A03B48;
    transform: translateY(-1px);
    box-shadow: 0 12px 24px rgba(122, 14, 26, 0.45);
  }

  @media (max-width: 480px) {
    .m-orders-page {
      margin-top: 2rem;
    }

    .m-table-wrap {
      padding-inline: 1rem;
    }
  }
</style>

<div class="m-orders-page">
  <h1 class="m-page-title">Manajemen Pesanan</h1>
  <p class="m-page-sub">
    
  </p>

  <!-- FILTER STATUS (GET) -->
  <form method="get" class="m-filter-bar">
    <span class="m-filter-label">Filter Status</span>
    <select name="status" class="m-filter-select" onchange="this.form.submit()">
      <option value="">Semua</option>
      {% for code, label in order_status_choices %}
        <option value="{{ code }}" {% if status_filter == code %}selected{% endif %}>
          {{ label }}
        </option>
      {% endfor %}
    </select>
  </form>

  <div class="m-table-wrap">
    <table class="m-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Tanggal</th>
          <th>Pelanggan</th>
          <th>Status</th>
          <th>Total</th>
          <th>Resi</th>
          <th>Shipping</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>#{{ order.id }}</td>
          <td>{{ order.created_at|date:"d M Y H:i" }}</td>
          <td>
            {{ order.customer.user.get_full_name|default:order.customer.user.username }}
          </td>

          <!-- kolom STATUS: select -->
          <td style="min-width:130px;">
            <form method="post"
                  action="{% url 'shop:management_order_update' order.id %}"
                  class="m-update-form">
              {% csrf_token %}
              <select name="status" class="m-update-select">
                {% for code, label in order_status_choices %}
                  <option value="{{ code }}" {% if order.status == code %}selected{% endif %}>
                    {{ label }}
                  </option>
                {% endfor %}
              </select>
          </td>

          <!-- kolom TOTAL -->
          <td>Rp {{ order.total|intcomma }}</td>

          <!-- kolom RESI -->
          <td style="min-width:170px;">
              <input type="text"
                     name="tracking_number"
                     class="m-update-input"
                     placeholder="Isi jika sudah dikirim"
                     value="{{ order.tracking_number|default:'' }}">
          </td>

          <!-- kolom SHIPPING STATUS -->
          <td style="min-width:150px;">
              <select name="shipping_status" class="m-update-select">
                {% for code, label in shipping_status_choices %}
                  <option value="{{ code }}" {% if order.shipping_status == code %}selected{% endif %}>
                    {{ label }}
                  </option>
                {% endfor %}
              </select>
          </td>

          <!-- kolom AKSI -->
          <td>
              <button type="submit" class="m-update-btn">
                Simpan
              </button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" style="padding-top:0.8rem;">
            Belum ada pesanan.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
